<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>milk: Function Parameter Structure (FPS)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">milk
   &#160;<span id="projectnumber">1.01</span>
   </div>
   <div id="projectbrief">Modular Image processing Library toolKit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page_FunctionParameterStructure.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Function Parameter Structure (FPS) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section note"><dt>Note</dt><dd>This file: ./src/CommandLineInterface/doc/FunctionParameterStructure.md</dd></dl>
<hr  />
<p><b>The function parameter structure (FPS) exposes a function's internal variables for read and/or write. It is stored in shared memory, in /MILK_SHM_DIR/fpsname.fps.shm.</b></p>
<p>Steps to run FPS-enabled processes: </p><pre class="fragment">$ vim fpslist.txt                    # Edit file, listing functions and corresponding FPS names that will be used
$ milk-fpsinit -e cacao -C           # create all (-C) FPS shared memory structure(s) and tmux sessions. Use cacao (-e) to launch commands
$ milk-fpsCTRL                       # FPS control tool, scan ALL FPSs (-m option force match with fpscmd/fpslist.txt)
</pre><hr  />
<h1><a class="anchor" id="page_FunctionParameterStructure_Overview"></a>
1. Overview and background</h1>
<h2>1.1. Main elements</h2>
<p>FPS-enabled functions have the following elements:</p>
<ul>
<li>The shared memory FPS: /tmp/fpsname.fps.shm</li>
<li>A configuration process that manages the FPS entries</li>
<li>A run process (the function itself)</li>
</ul>
<h2>1.2. FPS name</h2>
<p>&lt;fpsname&gt; consists of a root name (string), and a series of optional integers. Note that the number of digits matters and is part of the name: </p><pre class="fragment">&lt;fpsname&gt; = &lt;fpsnameroot&gt;.&lt;opt0&gt;.&lt;opt1&gt;...
</pre><p>Examples: </p><pre class="fragment">myfps                        # simple name, no optional integers
myfps-000000                 # optional integer 000000
myfps-000000-white-000002    # 3 optional args
</pre><dl class="section warning"><dt>Warning</dt><dd>The FPS name does not need to match the process or function name. FPS name is specified in the CLI function as described in <a class="el" href="page_FunctionParameterStructure.html#page_FunctionParameterStructure_WritingCLIfunc"><ol type="1">
<li>Writing the CLI function (in &lt;module&gt;.c file)</li>
</ol>
</a>.</dd></dl>
<h2>1.3. FPS-related entities</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">name </th><th class="markdownTableHeadNone">Type </th><th class="markdownTableHeadNone">Description </th><th class="markdownTableHeadNone">Origin  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">/MILK_SHM_DIR/fpsname.fps.shm </td><td class="markdownTableBodyNone">shared memory </td><td class="markdownTableBodyNone">FP structure </td><td class="markdownTableBodyNone">Created by FPS init function  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">fpsname:run </td><td class="markdownTableBodyNone">tmux session window 2 </td><td class="markdownTableBodyNone">FPS control terminal </td><td class="markdownTableBodyNone">Set up by milk-fpsinit  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">fpsname:conf </td><td class="markdownTableBodyNone">tmux session window 3 </td><td class="markdownTableBodyNone">where CONF runs </td><td class="markdownTableBodyNone">Set up by milk-fpsinit  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">fpsname:run </td><td class="markdownTableBodyNone">tmux session </td><td class="markdownTableBodyNone">where RUN runs </td><td class="markdownTableBodyNone">Set up by milk-fpsinit  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">/MILK_SHM_DIR/fpslog.tstamp.pid.FPSTYPE-fpsname </td><td class="markdownTableBodyNone">ASCII file </td><td class="markdownTableBodyNone">log files </td><td class="markdownTableBodyNone">Created by FPS processes  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">/MILK_SHM_DIR/fpslog.FPSTYPE-fpsname </td><td class="markdownTableBodyNone">sym link </td><td class="markdownTableBodyNone">log file </td><td class="markdownTableBodyNone">points to latest FPS log file  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">./fpsconf/fpsname/... </td><td class="markdownTableBodyNone">ASCII file </td><td class="markdownTableBodyNone">parameter value </td><td class="markdownTableBodyNone">OPTIONAL  </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="page_FunctionParameterStructure_UserInterface"></a>
2. FPS user interface</h1>
<p>Main steps to enable FPS-enabled function for fpsCTRL:</p>
<ul>
<li><b>Define which FPSs to enable</b>: Add entry in ./fpslist.txt</li>
<li><b>Set up FPSs entities</b>: Run milk-fpsinit</li>
<li><b>Control and monitor FPSs</b>: start milk-fpsCTRL</li>
</ul>
<p>These steps should ideally performed by a setup script.</p>
<h2><a class="anchor" id="page_FunctionParameterStructure_WritingFPSCMDscripts"></a>
2.1. Define which FPSs to enable with a &lt;tt&gt;fpslist.txt&lt;/tt&gt; file</h2>
<p>The user-provided <code>fpslist.txt</code> file lists the functions and corresponding FPS names that will be in use:</p>
<div class="fragment"><div class="line"># List of FPS-enabled function</div>
<div class="line"># Column 1: root name used to name FPS</div>
<div class="line"># Column 2: CLI command</div>
<div class="line"># Column(s) 3: optional arguments, string</div>
<div class="line"> </div>
<div class="line">fpsrootname0    CLIcommand0</div>
<div class="line">fpsrootname1    CLIcommand1     optarg0  optarg1</div>
</div><!-- fragment --><h2>2.2. Set up FPSs entities</h2>
<p>FPS are built by </p><pre class="fragment">$ milk-fpsinit
</pre><h2><a class="anchor" id="page_FunctionParameterStructure_fpsCTRL"></a>
2.3. milk-fpsCTRL tool</h2>
<p>The FPS control tool is started from the command line : </p><pre class="fragment">$ milk-fpsCTRL
</pre><p>A fifo is set up by milk-fpsCTRL to receive commands to start/stop the conf and run processes. Commands can also be issued directly from the milk-fpsCTRL GUI.</p>
<h3>2.3.1. Starting a conf process</h3>
<p>To start a run process, the user issues a command to the fifo : </p><pre class="fragment">echo "confstart fpsname-01" &gt;&gt; ${MILK_SHM_DIR}/${LOOPNAME}_fpsCTRL.fifo
</pre><p>The steps triggered by this command are :</p>
<ul>
<li>Command is processed by fifo command interpreter <a class="el" href="fps__processcmdline_8c.html#a6d713f6a6a02feb91ffd6df2bd4901c5" title="process command line">functionparameter_FPSprocess_cmdline()</a></li>
<li>The fifo command interpreter resolves the fps entry, and runs functionparameter_CONFstart(fps, fpsindex)</li>
<li>Pre-configured function fpsconfstart is executed within the tmux session :run window :<ul>
<li>fps CLI command is launched with argument "_CONFSTART_" :<ul>
<li>function_parameter_getFPSname_from_CLIfunc() called, sets data.FPS_CMDCODE = FPSCMDCODE_CONFSTART</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>2.2.2. Stopping a conf process</h3>
<p>To stop a conf process, the user issues a command to the fifo : </p><pre class="fragment">echo "confstop fpsname-01" &gt;&gt; ${MILK_SHM_DIR}/${LOOPNAME}_fpsCTRL.fifo
</pre><p>The steps triggered by this command are :</p>
<ul>
<li>Command is processed by fifo command interpreter <a class="el" href="fps__processcmdline_8c.html#a6d713f6a6a02feb91ffd6df2bd4901c5" title="process command line">functionparameter_FPSprocess_cmdline()</a></li>
<li>The fifo command interpreter resolves the fps entry, and runs functionparameter_CONFstop(fps, fpsindex)<ul>
<li>FUNCTION_PARAMETER_STRUCT_SIGNAL_CONFRUN flag is set to 0</li>
</ul>
</li>
</ul>
<h3>2.2.3. Starting a run process</h3>
<p>To start a run process, the user issues a command to the fifo : </p><pre class="fragment">echo "confstart fpsname-01" &gt;&gt; ${MILK_SHM_DIR}/${LOOPNAME}_fpsCTRL.fifo
</pre><p>The steps triggered by this command are :</p>
<ul>
<li>Command is processed by fifo command interpreter <a class="el" href="fps__processcmdline_8c.html#a6d713f6a6a02feb91ffd6df2bd4901c5" title="process command line">functionparameter_FPSprocess_cmdline()</a></li>
<li>The fifo command interpreter resolves the fps entry, and runs functionparameter_RUNstart(fps, fpsindex)</li>
<li>Pre-configured function fpsrunstart is executed within the tmux session :run window :<ul>
<li>fps CLI command is launched with argument "_RUNSTART_" :<ul>
<li>function_parameter_getFPSname_from_CLIfunc() called, sets data.FPS_CMDCODE = FPSCMDCODE_RUNSTART</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>2.3.4. Stopping a run process</h3>
<p>To stop a run process, the user issues a command to the fifo : </p><pre class="fragment">echo "runstop fpsname-01" &gt;&gt; ${MILK_SHM_DIR}/${LOOPNAME}_fpsCTRL.fifo
</pre><p>The steps triggered by this command are :</p>
<ul>
<li>Command is processed by fifo command interpreter <a class="el" href="fps__processcmdline_8c.html#a6d713f6a6a02feb91ffd6df2bd4901c5" title="process command line">functionparameter_FPSprocess_cmdline()</a></li>
<li>The fifo command interpreter resolves the fps entry, and runs functionparameter_RUNstop(fps, fpsindex)</li>
<li>Pre-configured function fpsrunstop is executed within the tmux session :ctrl window :<ul>
<li>fps CLI command is launched with argument "_RUNSTOP_" :<ul>
<li>function_parameter_getFPSname_from_CLIfunc() called, sets data.FPS_CMDCODE = FPSCMDCODE_RUNSTOP</li>
<li><a class="el" href="fps__execFPScmd_8c.html#a93d950bf9afa9269d500b89473965122" title="Execute FPS command.">function_parameter_execFPScmd()</a> called, calls conf process (function data.FPS_CONFfunc)</li>
<li>function_parameter_FPCONFsetup, called within conf process, configures variables for run stop <h2>- CTRL-c sent to run tmux session to ensure exit </h2>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="page_FunctionParameterStructure_WritingCLIfunc"></a>
3. Writing the CLI function (in &lt;module&gt;.c file)</h1>
<p>A single CLI function, named &lt;functionname&gt;_cli, will take the following arguments:</p>
<ul>
<li>arg1: A command code</li>
<li>arg2+: Optional arguments</li>
</ul>
<p>The command code is a string, and will determine the action to be executed:</p>
<ul>
<li><code>_FPSINIT_</code> : Initialize FPS for the function, look for parameter values on filesystem</li>
<li><code>_CONFSTART_</code> : Start the FPS configuration process</li>
<li><code>_CONFSTOP_</code> : Stop the FPS configuration process</li>
<li><code>_RUNSTART_</code> : Start the run process</li>
<li><code>_RUNSTOP_</code> : Stop the run process</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Why Optional arguments to CLI function ? </dd>
<dd>
Multiple instances of a C function may need to be running, each with its own FPS. Optional arguments provides a mechanism to differentiate the FPSs. They are appended to the FPS name following a dash. Optional arguments can be a number (usually integer) or a string.</dd></dl>
<p>Example source code below.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> errno_t ExampleFunction__cli()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Try FPS implementation</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set data.fpsname, providing default value as first arg, and set data.FPS_CMDCODE value.</span></div>
<div class="line">    <span class="comment">// Default FPS name will be used if CLI process has NOT been named.</span></div>
<div class="line">    <span class="comment">// See code in function_parameter.c for detailed rules.</span></div>
<div class="line"> </div>
<div class="line">    <a class="code" href="fps__getFPSargs_8c.html#ac0be7cfd283ecc34b09006c86672b4b1">function_parameter_getFPSargs_from_CLIfunc</a>(<span class="stringliteral">&quot;measlinRM&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(data.FPS_CMDCODE != 0) { <span class="comment">// use FPS implementation</span></div>
<div class="line">        <span class="comment">// set pointers to CONF and RUN functions</span></div>
<div class="line">        data.FPS_CONFfunc = ExampleFunction_FPCONF;</div>
<div class="line">        data.FPS_RUNfunc  = ExampleFunction_RUN;</div>
<div class="line">        <a class="code" href="fps__execFPScmd_8c.html#a93d950bf9afa9269d500b89473965122">function_parameter_execFPScmd</a>();</div>
<div class="line">        <span class="keywordflow">return</span> RETURN_SUCCESS;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// call non FPS implementation - all parameters specified at function launch</span></div>
<div class="line">    <span class="keywordflow">if</span>(</div>
<div class="line">        CLI_checkarg(1, CLIARG_FLOAT) +</div>
<div class="line">        CLI_checkarg(2, CLIARG_LONG)</div>
<div class="line">        == 0) {</div>
<div class="line">        ExampleFunction(</div>
<div class="line">            data.cmdargtoken[1].val.numf,</div>
<div class="line">            data.cmdargtoken[2].val.numl</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> RETURN_SUCCESS;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">return</span> CLICMD_INVALID_ARG;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="page_FunctionParameterStructure_WritingPrototypes"></a>
4. Writing function prototypes (in &lt;module&gt;.h)</h1>
<div class="fragment"><div class="line">errno_t ExampleFunction_FPCONF();</div>
<div class="line">errno_t ExampleFunction_RUN();</div>
<div class="line">errno_t ExampleFunction(<span class="keywordtype">long</span> arg0num, <span class="keywordtype">long</span> arg1num, <span class="keywordtype">long</span> arg2num, <span class="keywordtype">long</span> arg3num);</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="page_FunctionParameterStructure_WritingCONFfunc"></a>
5. Writing CONF function (in source .c file)</h1>
<p>Check <a class="el" href="function__parameters_8h.html" title="Tools to help expose and control function parameters.">function_parameters.h</a> for full list of flags.</p>
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// manages configuration parameters</span></div>
<div class="line"><span class="comment">// initializes configuration parameters structure</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">errno_t ExampleFunction_FPCONF()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ===========================</span></div>
<div class="line">    <span class="comment">// SETUP FPS</span></div>
<div class="line">    <span class="comment">// ===========================</span></div>
<div class="line">    <a class="code" href="group__fpsmacro.html#gade74dae399d86f7240287f5255bc13f3">FPS_SETUP_INIT</a>(data.FPS_name, data.FPS_CMDCODE); <span class="comment">// macro in function_parameter.h</span></div>
<div class="line">    fps_add_processinfo_entries(&amp;fps); <span class="comment">// include real-time settings</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ==============================================</span></div>
<div class="line">    <span class="comment">// ========= ALLOCATE FPS ENTRIES ===============</span></div>
<div class="line">    <span class="comment">// ==============================================</span></div>
<div class="line"> </div>
<div class="line">    uint64_t FPFLAG;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Entries are added one by one with function_parameter_add_entry()</span></div>
<div class="line">    <span class="comment">// For each entry, we record the function parameter index (fpi_) returned by the function so that parameters can conveniently be accesses in the &quot;LOGIC&quot; section</span></div>
<div class="line">    <span class="comment">// Arguments:</span></div>
<div class="line">    <span class="comment">//   - pointer to fps</span></div>
<div class="line">    <span class="comment">//   - parameter path for GUI</span></div>
<div class="line">    <span class="comment">//   - description</span></div>
<div class="line">    <span class="comment">//   - type</span></div>
<div class="line">    <span class="comment">//   - flags</span></div>
<div class="line">    <span class="comment">//   - initialization pointer. If pNull, then the variable is not initialized</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Check CommandLineInterface/function_parameters.h for full list of flags.</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">long</span> fpi_param01 = <a class="code" href="fps__add__entry_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.param01&quot;</span>, <span class="stringliteral">&quot;First parameter&quot;</span>,</div>
<div class="line">                       FPTYPE_INT64, FPFLAG_DEFAULT_INPUT, NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// This parameter will be intitialized to a value of 5, min-max range from 0 to 10, and current value 5</span></div>
<div class="line">    int64_t param02default[4] = { 5, 0, 10, 5 };</div>
<div class="line">    FPFLAG = FPFLAG_DEFAULT_INPUT | FPFLAG_MINLIMIT | FPFLAG_MAXLIMIT;  <span class="comment">// required to enforce the min and max limits</span></div>
<div class="line">    FPFLAG &amp;= ~FPFLAG_WRITECONF;  <span class="comment">// Don&#39;t allow parameter to be written during configuration</span></div>
<div class="line">    FPFLAG &amp;= ~FPFLAG_WRITERUN;   <span class="comment">// Don&#39;t allow parameter to be written during run</span></div>
<div class="line">    <span class="keywordtype">long</span> fpi_param02 = <a class="code" href="fps__add__entry_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.param02&quot;</span>, <span class="stringliteral">&quot;Second parameter&quot;</span>,</div>
<div class="line">                       FPTYPE_INT64, FPFLAG, &amp;param02default);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// if parameter type = FPTYPE_FLOAT32, make sure default is declared as float[4]</span></div>
<div class="line">    <span class="comment">// if parameter type = FPTYPE_FLOAT64, make sure default is declared as double[4]</span></div>
<div class="line">    <span class="keywordtype">float</span> gaindefault[4] = { 0.01, 0.0, 1.0, 0.01 };</div>
<div class="line">    FPFLAG = FPFLAG_DEFAULT_INPUT | FPFLAG_MINLIMIT | FPFLAG_MAXLIMIT;  <span class="comment">// required to enforce the min and max limits</span></div>
<div class="line">    <span class="keywordtype">long</span> fpi_gain = <a class="code" href="fps__add__entry_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.gain&quot;</span>, <span class="stringliteral">&quot;gain value&quot;</span>,</div>
<div class="line">                    FPTYPE_FLOAT32, FPFLAG, &amp;gaindefault);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// This parameter is a ON / OFF toggle</span></div>
<div class="line">    <span class="keywordtype">long</span> fpi_gainset = <a class="code" href="fps__add__entry_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.option.gainwrite&quot;</span>, <span class="stringliteral">&quot;gain can be changed&quot;</span>,</div>
<div class="line">                       FPTYPE_ONOFF, FPFLAG_DEFAULT_INPUT, NULL);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// stream that needs to be loaded on startup</span></div>
<div class="line">    FPFLAG = FPFLAG_DEFAULT_INPUT_STREAM;</div>
<div class="line">    <span class="keywordtype">long</span> fpi_streamname_wfs       = <a class="code" href="fps__add__entry_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.sn_wfs&quot;</span>,  <span class="stringliteral">&quot;WFS stream name&quot;</span>,</div>
<div class="line">                                    FPTYPE_STREAMNAME, FPFLAG, NULL);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Output file name</span></div>
<div class="line">    <span class="keywordtype">long</span> fpi_filename_out1          = <a class="code" href="fps__add__entry_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.out.fname_out1&quot;</span>, <span class="stringliteral">&quot;output file 1&quot;</span>,</div>
<div class="line">                                      FPTYPE_FILENAME, FPFLAG_DEFAULT_OUTPUT, NULL);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Macros examples</span></div>
<div class="line">    <span class="comment">// see function_parameters.h</span></div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__fpsmacro.html#ga77703f31cda37f9177a693255b5f1e01">FPS_ADDPARAM_STREAM_IN</a>  (stream_inname,        <span class="stringliteral">&quot;.in_name&quot;</span>,     <span class="stringliteral">&quot;input stream&quot;</span>, NULL);</div>
<div class="line">    <a class="code" href="group__fpsmacro.html#ga120eaf4f3272629185c5e872b83a6653">FPS_ADDPARAM_STREAM_OUT</a> (stream_outname,       <span class="stringliteral">&quot;.out_name&quot;</span>,    <span class="stringliteral">&quot;output stream&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">long</span> timeavemode_default[4] = { 0, 0, 3, 0 };</div>
<div class="line">    <a class="code" href="group__fpsmacro.html#gaab206dfb7e0f3a20b61014d25b020ea5">FPS_ADDPARAM_INT64_IN</a>  (</div>
<div class="line">        option_timeavemode,</div>
<div class="line">        <span class="stringliteral">&quot;.option.timeavemode&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;Enable time window averaging (&gt;0)&quot;</span>,</div>
<div class="line">        &amp;timeavemode_default);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> avedt_default[4] = { 0.001, 0.0001, 1.0, 0.001};</div>
<div class="line">    <a class="code" href="group__fpsmacro.html#ga56c1fc50f8614a995f6d7ef3b1dd5c97">FPS_ADDPARAM_FLT64_IN</a>  (</div>
<div class="line">        option_avedt,</div>
<div class="line">        <span class="stringliteral">&quot;.option.avedt&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;Averaging time window width&quot;</span>,</div>
<div class="line">        &amp;avedt_default);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// status</span></div>
<div class="line">    <a class="code" href="group__fpsmacro.html#ga2117a2acad5b9adc43a00893af4181cc">FPS_ADDPARAM_INT64_OUT</a> (zsize,        <span class="stringliteral">&quot;.status.zsize&quot;</span>,     <span class="stringliteral">&quot;cube size&quot;</span>);</div>
<div class="line">    <a class="code" href="group__fpsmacro.html#ga2117a2acad5b9adc43a00893af4181cc">FPS_ADDPARAM_INT64_OUT</a> (framelog,     <span class="stringliteral">&quot;.status.framelag&quot;</span>,  <span class="stringliteral">&quot;lag in frame unit&quot;</span>);</div>
<div class="line">    <a class="code" href="group__fpsmacro.html#ga2117a2acad5b9adc43a00893af4181cc">FPS_ADDPARAM_INT64_OUT</a> (kkin,         <span class="stringliteral">&quot;.status.kkin&quot;</span>,      <span class="stringliteral">&quot;input cube slice index&quot;</span>);</div>
<div class="line">    <a class="code" href="group__fpsmacro.html#ga2117a2acad5b9adc43a00893af4181cc">FPS_ADDPARAM_INT64_OUT</a> (kkout,        <span class="stringliteral">&quot;.status.kkout&quot;</span>,     <span class="stringliteral">&quot;output cube slice index&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ==============================================</span></div>
<div class="line">    <span class="comment">// ======== START FPS CONF LOOP =================</span></div>
<div class="line">    <span class="comment">// ==============================================</span></div>
<div class="line">    <a class="code" href="group__fpsmacro.html#gae70fe94849793f147fdd38b35fd5d413">FPS_CONFLOOP_START</a>  <span class="comment">// macro in function_parameter.h</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// here goes the logic</span></div>
<div class="line">    <span class="keywordflow">if</span> ( fps.parray[fpi_gainset].fpflag &amp; FPFLAG_ONOFF )  <span class="comment">// ON state</span></div>
<div class="line">    {</div>
<div class="line">        fps.parray[fpi_gain].fpflag |= FPFLAG_WRITERUN;</div>
<div class="line">        fps.parray[fpi_gain].fpflag |= FPFLAG_USED;</div>
<div class="line">        fps.parray[fpi_gain].fpflag |= FPFLAG_VISIBLE;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="comment">// OFF state</span></div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">        fps.parray[fpi_gain].fpflag &amp;= ~FPFLAG_WRITERUN;</div>
<div class="line">        fps.parray[fpi_gain].fpflag &amp;= ~FPFLAG_USED;</div>
<div class="line">        fps.parray[fpi_gain].fpflag &amp;= ~FPFLAG_VISIBLE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ==============================================</span></div>
<div class="line">    <span class="comment">// ======== STOP FPS CONF LOOP ==================</span></div>
<div class="line">    <span class="comment">// ==============================================</span></div>
<div class="line">    <a class="code" href="group__fpsmacro.html#gaf877980990542985f9d4f97422865ede">FPS_CONFLOOP_END</a>  <span class="comment">// macro in function_parameter.h</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> RETURN_SUCCESS;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="page_FunctionParameterStructure_WritingRUNfunc"></a>
6. Writing RUN function (in source .c file)</h1>
<p>The RUN function will connect to the FPS and execute the run loop.</p>
<h2><a class="anchor" id="page_FunctionParameterStructure_WritingRUNfunc_simple"></a>
6.1. A simple _RUN example</h2>
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// run loop process</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">errno_t ExampleFunction_RUN()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ===========================</span></div>
<div class="line">    <span class="comment">// CONNECT TO FPS</span></div>
<div class="line">    <span class="comment">// ===========================</span></div>
<div class="line">    <a class="code" href="group__fpsmacro.html#gac759a6212d458404869a2ab872dcddfd">FPS_CONNECT</a>(data.FPS_name, FPSCONNECT_RUN );</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ===============================</span></div>
<div class="line">    <span class="comment">// GET FUNCTION PARAMETER VALUES</span></div>
<div class="line">    <span class="comment">// ===============================</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// parameters are addressed by their tag name</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// These parameters are read once, before running the loop</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordtype">int</span> param01 = functionparameter_GetParamValue_INT64(&amp;fps, <span class="stringliteral">&quot;.param01&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> param02 = functionparameter_GetParamValue_INT64(&amp;fps, <span class="stringliteral">&quot;.param02&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// This parameter is a ON / OFF toggle</span></div>
<div class="line">    <span class="keywordtype">int</span> gainwrite = functionparameter_GetParamValue_ONOFF(&amp;fps, <span class="stringliteral">&quot;.option.gainwrite&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// This parameter value will be tracked during loop run, so we create a pointer for it</span></div>
<div class="line">    <span class="comment">// The corresponding function is functionparameter_GetParamPtr_&lt;TYPE&gt;</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordtype">float</span> *gain = functionparameter_GetParamPtr_FLOAT32(&amp;fps, <span class="stringliteral">&quot;.status.loopcnt&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> imsname[FUNCTION_PARAMETER_STRMAXLEN];</div>
<div class="line">    strncpy(imsname, functionparameter_GetParamPtr_STRING(&amp;fps, <span class="stringliteral">&quot;.option.imname&quot;</span>), FUNCTION_PARAMETER_STRMAXLEN);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// connect to WFS image</span></div>
<div class="line">        <span class="keywordtype">long</span> IDim = read_sharedmem_image(imsname);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ===============================</span></div>
<div class="line">    <span class="comment">// RUN LOOP</span></div>
<div class="line">    <span class="comment">// ===============================</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> loopOK = 1;</div>
<div class="line">    <span class="keywordflow">while</span>( loopOK == 1 )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// here we compute what we need...</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Note that some mechanism is required to set loopOK to 0 when MyFunction_Stop() is called</span></div>
<div class="line">        <span class="comment">// This can use a separate shared memory path</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    function_parameter_RUNexit( &amp;fps );</div>
<div class="line">    <span class="keywordflow">return</span> RETURN_SUCCESS;</div>
<div class="line">}</div>
</div><!-- fragment --><h2>6.2. Non-FPS fallback function</h2>
<div class="fragment"><div class="line">errno_t ExampleFunction(</div>
<div class="line">    <span class="keywordtype">long</span> arg0num,</div>
<div class="line">    <span class="keywordtype">long</span> arg1num,</div>
<div class="line">    <span class="keywordtype">long</span> arg2num,</div>
<div class="line">    <span class="keywordtype">long</span> arg3num</div>
<div class="line">) {</div>
<div class="line">    <span class="keywordtype">long</span> pindex = (long) getpid();  <span class="comment">// index used to differentiate multiple calls to function</span></div>
<div class="line">    <span class="comment">// if we don&#39;t have anything more informative, we use PID</span></div>
<div class="line"> </div>
<div class="line">    <a class="code" href="structFUNCTION__PARAMETER__STRUCT.html">FUNCTION_PARAMETER_STRUCT</a> fps;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// create FPS</span></div>
<div class="line">    sprintf(data.FPS_name, <span class="stringliteral">&quot;exfunc-%06ld&quot;</span>, pindex);</div>
<div class="line">    data.FPS_CMDCODE = FPSCMDCODE_FPSINIT;</div>
<div class="line">    ExampleFunction_FPCONF();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="fps__connect_8c.html#a4eb2b4db6e7d81a93556e26a0a1df6cc">function_parameter_struct_connect</a>(data.FPS_name, &amp;fps, FPSCONNECT_SIMPLE);</div>
<div class="line"> </div>
<div class="line">    functionparameter_SetParamValue_INT64(&amp;fps, <span class="stringliteral">&quot;.arg0&quot;</span>, arg0);</div>
<div class="line">    functionparameter_SetParamValue_INT64(&amp;fps, <span class="stringliteral">&quot;.arg1&quot;</span>, arg1);</div>
<div class="line">    functionparameter_SetParamValue_INT64(&amp;fps, <span class="stringliteral">&quot;.arg2&quot;</span>, arg2);</div>
<div class="line">    functionparameter_SetParamValue_INT64(&amp;fps, <span class="stringliteral">&quot;.arg3&quot;</span>, arg3);</div>
<div class="line"> </div>
<div class="line">    function_parameter_struct_disconnect(&amp;fps);</div>
<div class="line"> </div>
<div class="line">    ExampleFunction_RUN();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> RETURN_SUCCESS;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="page_FunctionParameterStructure_WritingRUNfunc_processinfo"></a>
6.3. RUN function with FPS and processinfo</h2>
<p>In this example, the loop process supports both FPS and processinfo. This is the preferred way to code a loop process.</p>
<h3>6.3.1. Simple example making extensive use of macros (concept - to be implemented)</h3>
<div class="fragment"><div class="line">errno_t MyFunction_RUN()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ========= INITIALIZATION</span></div>
<div class="line">    FPSPROCINFOLOOP_INIT(<span class="stringliteral">&quot;computes something&quot;</span>, <span class="stringliteral">&quot;add image1 to image2&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ========= GET VALUES FROM FPS</span></div>
<div class="line">    <span class="keywordtype">int</span> param01 = functionparameter_GetParamValue_INT64(&amp;fps, <span class="stringliteral">&quot;.param01&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ========= Specify input stream trigger by name</span></div>
<div class="line">    PROCESSINFO_SET_SEMSTREAMWAIT(<span class="stringliteral">&quot;inputstreamname&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ========= Identifiers for output streams</span></div>
<div class="line">    imageID IDout = image_ID(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    PROCINFOLOOP_START;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// computation ....</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line"> </div>
<div class="line">    data.image[IDout].md[0].<a class="code" href="structIMAGE__METADATA.html#aaa6697c2d6277f5d0db1cf8306fd58a5">write</a> = 1;</div>
<div class="line">    <span class="comment">// write into output image</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Post semaphore(s) and counter(s), notify system that outputs have been written</span></div>
<div class="line">    <a class="code" href="processtools_8c.html#a2ba8c631777ab45b8cdc42ce88265ebd">processinfo_update_output_stream</a>(processinfo, IDout);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    PROCINFOLOOP_END;</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><h3>6.3.2. Verbose example with customization</h3>
<p>The example also shows using FPS to set the process realtime priority.</p>
<div class="fragment"><div class="line"> </div>
<div class="line">errno_t MyFunction_RUN()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ==================================================</span></div>
<div class="line">    <span class="comment">// ### Connect to FUNCTION PARAMETER STRUCTURE (FPS)</span></div>
<div class="line">    <span class="comment">// ==================================================</span></div>
<div class="line">    <a class="code" href="group__fpsmacro.html#gac759a6212d458404869a2ab872dcddfd">FPS_CONNECT</a>( data.FPS_name, FPSCONNECT_RUN );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Write time string (optional, requires .out.timestring entry)</span></div>
<div class="line">    <span class="keywordtype">char</span> timestring[100];</div>
<div class="line">    mkUTtimestring_millisec(timestring);</div>
<div class="line">    functionparameter_SetParamValue_STRING(</div>
<div class="line">        &amp;fps,</div>
<div class="line">        <span class="stringliteral">&quot;.out.timestring&quot;</span>,</div>
<div class="line">        timestring);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ===================================</span></div>
<div class="line">    <span class="comment">// ### GET VALUES FROM FPS</span></div>
<div class="line">    <span class="comment">// ===================================</span></div>
<div class="line">    <span class="comment">// parameters are addressed by their tag name</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// These parameters are read once, before running the loop</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordtype">int</span> param01 = functionparameter_GetParamValue_INT64(&amp;fps, <span class="stringliteral">&quot;.param01&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> param02 = functionparameter_GetParamValue_INT64(&amp;fps, <span class="stringliteral">&quot;.param02&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> nameim[FUNCTION_PARAMETER_STRMAXLEN+1];</div>
<div class="line">    strncpy(nameim, functionparameter_GetParamPtr_STRING(&amp;fps, <span class="stringliteral">&quot;.option.nameim&quot;</span>), FUNCTION_PARAMETER_STRMAXLEN);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// This parameter value will be tracked during loop run, so we create a pointer for it</span></div>
<div class="line">    <span class="comment">// The corresponding function is functionparameter_GetParamPtr_&lt;TYPE&gt;</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordtype">float</span> *gain = functionparameter_GetParamPtr_FLOAT32(&amp;fps, <span class="stringliteral">&quot;.ctrl.gain&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ===========================</span></div>
<div class="line">    <span class="comment">// ### processinfo support </span></div>
<div class="line">    <span class="comment">// ===========================</span></div>
<div class="line"> </div>
<div class="line">    <a class="code" href="structPROCESSINFO.html">PROCESSINFO</a> *processinfo;</div>
<div class="line"> </div>
<div class="line">    processinfo = processinfo_setup(</div>
<div class="line">        data.FPS_name,               <span class="comment">// re-use fpsname as processinfo name</span></div>
<div class="line">        <span class="stringliteral">&quot;computes something&quot;</span>,        <span class="comment">// description</span></div>
<div class="line">        <span class="stringliteral">&quot;add image1 to image2&quot;</span>,      <span class="comment">// message on startup</span></div>
<div class="line">        __FUNCTION__, __FILE__, __LINE__</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// OPTIONAL SETTINGS</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Measure timing</span></div>
<div class="line">    processinfo-&gt;MeasureTiming = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// RT_priority, 0-99. Larger number = higher priority. If &lt;0, ignore</span></div>
<div class="line">    processinfo-&gt;RT_priority = 20;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// max number of iterations. -1 if infinite</span></div>
<div class="line">    processinfo-&gt;loopcntMax = 1000;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// apply relevant FPS entries to PROCINFO</span></div>
<div class="line">    <span class="comment">// see macro code for details</span></div>
<div class="line">    fps_to_processinfo(&amp;fps, processinfo);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> loopOK = 1;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// =============================================</span></div>
<div class="line">    <span class="comment">// OPTIONAL: TESTING CONDITION FOR LOOP ENTRY</span></div>
<div class="line">    <span class="comment">// =============================================</span></div>
<div class="line">    <span class="comment">// Pre-loop testing, anything that would prevent loop from starting should issue message</span></div>
<div class="line">    <span class="keywordtype">int</span> loopOK = 1;</div>
<div class="line">    <span class="keywordflow">if</span>(.... error condition ....)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// exit function with ERROR status</span></div>
<div class="line">        processinfo_error(processinfo, <span class="stringliteral">&quot;ERROR: no WFS reference&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> RETURN_FAILURE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Specify input stream trigger</span></div>
<div class="line">    IDin = image_ID(<span class="stringliteral">&quot;inputstream&quot;</span>);</div>
<div class="line">    <a class="code" href="processtools_8c.html#a49e6e59f8dcae2d60440cf1f254a134c">processinfo_waitoninputstream_init</a>(processinfo, IDin,</div>
<div class="line">        PROCESSINFO_TRIGGERMODE_SEMAPHORE, -1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Identifiers for output streams</span></div>
<div class="line">    imageID IDout0 = image_ID(<span class="stringliteral">&quot;output0&quot;</span>);</div>
<div class="line">    imageID IDout1 = image_ID(<span class="stringliteral">&quot;output1&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ===========================</span></div>
<div class="line">    <span class="comment">// ### Start loop</span></div>
<div class="line">    <span class="comment">// ===========================</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Notify processinfo that we are entering loop</span></div>
<div class="line">    processinfo_loopstart(processinfo);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span>(loopOK==1)</div>
<div class="line">    {</div>
<div class="line">        loopOK = processinfo_loopstep(processinfo);</div>
<div class="line">        <a class="code" href="processtools_8c.html#a6e6cd115648bf837b760414e829882bb">processinfo_waitoninputstream</a>(processinfo);</div>
<div class="line"> </div>
<div class="line">        processinfo_exec_start(processinfo);</div>
<div class="line">        <span class="keywordflow">if</span>(processinfo_compute_status(processinfo)==1)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// computation ....</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line"> </div>
<div class="line">            data.image[IDout0].md[0].<a class="code" href="structIMAGE__METADATA.html#aaa6697c2d6277f5d0db1cf8306fd58a5">write</a> = 1;</div>
<div class="line">            data.image[IDout1].md[0].<a class="code" href="structIMAGE__METADATA.html#aaa6697c2d6277f5d0db1cf8306fd58a5">write</a> = 1;</div>
<div class="line">            <span class="comment">// write into output images</span></div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Post semaphore(s) and counter(s), notify system that outputs have been written</span></div>
<div class="line">            <a class="code" href="processtools_8c.html#a2ba8c631777ab45b8cdc42ce88265ebd">processinfo_update_output_stream</a>(processinfo, IDout0);</div>
<div class="line">            <a class="code" href="processtools_8c.html#a2ba8c631777ab45b8cdc42ce88265ebd">processinfo_update_output_stream</a>(processinfo, IDout1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// process signals, increment loop counter</span></div>
<div class="line">        processinfo_exec_end(processinfo);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// OPTIONAL: MESSAGE WHILE LOOP RUNNING</span></div>
<div class="line">        processinfo_WriteMessage(processinfo, <span class="stringliteral">&quot;loop running fine&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ==================================</span></div>
<div class="line">    <span class="comment">// ### ENDING LOOP</span></div>
<div class="line">    <span class="comment">// ==================================</span></div>
<div class="line"> </div>
<div class="line">    processinfo_cleanExit(processinfo);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ==================================</span></div>
<div class="line">    <span class="comment">// ### SAVING RESULTS (OPTIONAL)</span></div>
<div class="line">    <span class="comment">// ==================================</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Conventions</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Everything saved in directory fps.md-&gt;outdir, which by default is</span></div>
<div class="line">    <span class="comment">// fp.md-&gt;fpsdirectory/out-fpsname, but can also be set by user parameter conf.outdir.</span></div>
<div class="line">    <span class="comment">// conf.outdir is relative to fps.md-&gt;workdir</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// save FPS content</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="fps__save2disk_8c.html#addef5a0143d868aba3eaa071231684d3">functionparameter_SaveFPS2disk</a>(&amp;fps);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// save image</span></div>
<div class="line">    <span class="comment">// note that the saved-as name (last arg) could be different from image name (2nd arg)</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="fps__save2disk_8c.html#a2b143c02911784732974b7303a41fd33">fps_write_RUNoutput_image</a>(&amp;fps, <span class="stringliteral">&quot;output0&quot;</span>, <span class="stringliteral">&quot;output0&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// save file</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    FILE *fpout1 = <a class="code" href="fps__save2disk_8c.html#abf1f9070b5f20e3823acea7b8127f5b5">fps_write_RUNoutput_file</a>(&amp;fps, <span class="stringliteral">&quot;somedata&quot;</span>, <span class="stringliteral">&quot;dat&quot;</span>);</div>
<div class="line">    fprintf(fpout1, <span class="stringliteral">&quot;0.123445&quot;</span>);</div>
<div class="line">    fclose(fpout1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create archiving script that will copy files to directory datadir (usually a sym link)</span></div>
<div class="line">    <a class="code" href="fps__save2disk_8c.html#a6915bc1359aa85b6b4aab66ab61aad00">functionparameter_write_archivescript</a>(&amp;fps);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__errcheckmacro.html#ga14f67fddf883bc5a22004f4f648c17a5">EXECUTE_SYSTEM_COMMAND</a>(<span class="stringliteral">&quot;cd %s&quot;</span>, fps.md-&gt;workdir);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// optional: run exec scripts that take FPSname as argument</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    function_parameter_RUNexit( &amp;fps  );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> RETURN_SUCCESS;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="afps__save2disk_8c_html_a2b143c02911784732974b7303a41fd33"><div class="ttname"><a href="fps__save2disk_8c.html#a2b143c02911784732974b7303a41fd33">fps_write_RUNoutput_image</a></div><div class="ttdeci">errno_t fps_write_RUNoutput_image(FUNCTION_PARAMETER_STRUCT *fps, const char *imagename, const char *outname)</div><div class="ttdoc">Save image as FITS.</div><div class="ttdef"><b>Definition:</b> fps_save2disk.c:225</div></div>
<div class="ttc" id="astructPROCESSINFO_html"><div class="ttname"><a href="structPROCESSINFO.html">PROCESSINFO</a></div><div class="ttdef"><b>Definition:</b> processtools.h:92</div></div>
<div class="ttc" id="afps__save2disk_8c_html_addef5a0143d868aba3eaa071231684d3"><div class="ttname"><a href="fps__save2disk_8c.html#addef5a0143d868aba3eaa071231684d3">functionparameter_SaveFPS2disk</a></div><div class="ttdeci">int functionparameter_SaveFPS2disk(FUNCTION_PARAMETER_STRUCT *fps)</div><div class="ttdoc">save entire FPS to disk</div><div class="ttdef"><b>Definition:</b> fps_save2disk.c:106</div></div>
<div class="ttc" id="astructFUNCTION__PARAMETER__STRUCT_html"><div class="ttname"><a href="structFUNCTION__PARAMETER__STRUCT.html">FUNCTION_PARAMETER_STRUCT</a></div><div class="ttdef"><b>Definition:</b> function_parameters.h:502</div></div>
<div class="ttc" id="aprocesstools_8c_html_a2ba8c631777ab45b8cdc42ce88265ebd"><div class="ttname"><a href="processtools_8c.html#a2ba8c631777ab45b8cdc42ce88265ebd">processinfo_update_output_stream</a></div><div class="ttdeci">errno_t processinfo_update_output_stream(PROCESSINFO *processinfo, imageID outstreamID)</div><div class="ttdoc">Update ouput stream at completion of processinfo-enabled loop iteration.</div><div class="ttdef"><b>Definition:</b> processtools.c:1323</div></div>
<div class="ttc" id="afps__save2disk_8c_html_a6915bc1359aa85b6b4aab66ab61aad00"><div class="ttname"><a href="fps__save2disk_8c.html#a6915bc1359aa85b6b4aab66ab61aad00">functionparameter_write_archivescript</a></div><div class="ttdeci">errno_t functionparameter_write_archivescript(FUNCTION_PARAMETER_STRUCT *fps)</div><div class="ttdoc">Write archive script to .log2fps entry.</div><div class="ttdef"><b>Definition:</b> fps_save2disk.c:150</div></div>
<div class="ttc" id="afps__execFPScmd_8c_html_a93d950bf9afa9269d500b89473965122"><div class="ttname"><a href="fps__execFPScmd_8c.html#a93d950bf9afa9269d500b89473965122">function_parameter_execFPScmd</a></div><div class="ttdeci">errno_t function_parameter_execFPScmd()</div><div class="ttdoc">Execute FPS command.</div><div class="ttdef"><b>Definition:</b> fps_execFPScmd.c:17</div></div>
<div class="ttc" id="agroup__fpsmacro_html_ga2117a2acad5b9adc43a00893af4181cc"><div class="ttname"><a href="group__fpsmacro.html#ga2117a2acad5b9adc43a00893af4181cc">FPS_ADDPARAM_INT64_OUT</a></div><div class="ttdeci">#define FPS_ADDPARAM_INT64_OUT(key, pname, pdescr)</div><div class="ttdoc">Add INT64 output parameter entry.</div><div class="ttdef"><b>Definition:</b> function_parameters.h:847</div></div>
<div class="ttc" id="aprocesstools_8c_html_a6e6cd115648bf837b760414e829882bb"><div class="ttname"><a href="processtools_8c.html#a6e6cd115648bf837b760414e829882bb">processinfo_waitoninputstream</a></div><div class="ttdeci">errno_t processinfo_waitoninputstream(PROCESSINFO *processinfo)</div><div class="ttdoc">Wait on a stream.</div><div class="ttdef"><b>Definition:</b> processtools.c:1162</div></div>
<div class="ttc" id="astructIMAGE__METADATA_html_aaa6697c2d6277f5d0db1cf8306fd58a5"><div class="ttname"><a href="structIMAGE__METADATA.html#aaa6697c2d6277f5d0db1cf8306fd58a5">IMAGE_METADATA::write</a></div><div class="ttdeci">uint8_t write</div><div class="ttdef"><b>Definition:</b> ImageStruct.h:323</div></div>
<div class="ttc" id="agroup__fpsmacro_html_ga77703f31cda37f9177a693255b5f1e01"><div class="ttname"><a href="group__fpsmacro.html#ga77703f31cda37f9177a693255b5f1e01">FPS_ADDPARAM_STREAM_IN</a></div><div class="ttdeci">#define FPS_ADDPARAM_STREAM_IN(key, pname, pdescr, dflt)</div><div class="ttdoc">Add stream input parameter entry.</div><div class="ttdef"><b>Definition:</b> function_parameters.h:805</div></div>
<div class="ttc" id="afps__connect_8c_html_a4eb2b4db6e7d81a93556e26a0a1df6cc"><div class="ttname"><a href="fps__connect_8c.html#a4eb2b4db6e7d81a93556e26a0a1df6cc">function_parameter_struct_connect</a></div><div class="ttdeci">long function_parameter_struct_connect(const char *name, FUNCTION_PARAMETER_STRUCT *fps, int fpsconnectmode)</div><div class="ttdoc">Connect to function parameter structure.</div><div class="ttdef"><b>Definition:</b> fps_connect.c:33</div></div>
<div class="ttc" id="agroup__fpsmacro_html_gaf877980990542985f9d4f97422865ede"><div class="ttname"><a href="group__fpsmacro.html#gaf877980990542985f9d4f97422865ede">FPS_CONFLOOP_END</a></div><div class="ttdeci">#define FPS_CONFLOOP_END</div><div class="ttdoc">End FPS configuration loop.</div><div class="ttdef"><b>Definition:</b> function_parameters.h:749</div></div>
<div class="ttc" id="agroup__fpsmacro_html_ga56c1fc50f8614a995f6d7ef3b1dd5c97"><div class="ttname"><a href="group__fpsmacro.html#ga56c1fc50f8614a995f6d7ef3b1dd5c97">FPS_ADDPARAM_FLT64_IN</a></div><div class="ttdeci">#define FPS_ADDPARAM_FLT64_IN(key, pname, pdescr, dflt)</div><div class="ttdoc">Add 32-bit float parameter entry.</div><div class="ttdef"><b>Definition:</b> function_parameters.h:774</div></div>
<div class="ttc" id="afps__getFPSargs_8c_html_ac0be7cfd283ecc34b09006c86672b4b1"><div class="ttname"><a href="fps__getFPSargs_8c.html#ac0be7cfd283ecc34b09006c86672b4b1">function_parameter_getFPSargs_from_CLIfunc</a></div><div class="ttdeci">errno_t function_parameter_getFPSargs_from_CLIfunc(char *fpsname_default)</div><div class="ttdoc">get FPS arguments from command line function call</div><div class="ttdef"><b>Definition:</b> fps_getFPSargs.c:20</div></div>
<div class="ttc" id="agroup__fpsmacro_html_gade74dae399d86f7240287f5255bc13f3"><div class="ttname"><a href="group__fpsmacro.html#gade74dae399d86f7240287f5255bc13f3">FPS_SETUP_INIT</a></div><div class="ttdeci">#define FPS_SETUP_INIT(VARfpsname, VARCMDmode)</div><div class="ttdoc">Initialize function parameter structure (FPS)</div><div class="ttdef"><b>Definition:</b> function_parameters.h:703</div></div>
<div class="ttc" id="agroup__fpsmacro_html_ga120eaf4f3272629185c5e872b83a6653"><div class="ttname"><a href="group__fpsmacro.html#ga120eaf4f3272629185c5e872b83a6653">FPS_ADDPARAM_STREAM_OUT</a></div><div class="ttdeci">#define FPS_ADDPARAM_STREAM_OUT(key, pname, pdescr)</div><div class="ttdoc">Add stream output parameter entry.</div><div class="ttdef"><b>Definition:</b> function_parameters.h:857</div></div>
<div class="ttc" id="aprocesstools_8c_html_a49e6e59f8dcae2d60440cf1f254a134c"><div class="ttname"><a href="processtools_8c.html#a49e6e59f8dcae2d60440cf1f254a134c">processinfo_waitoninputstream_init</a></div><div class="ttdeci">errno_t processinfo_waitoninputstream_init(PROCESSINFO *processinfo, imageID trigID, int triggermode, int semindexrequested)</div><div class="ttdoc">Set up input wait stream.</div><div class="ttdef"><b>Definition:</b> processtools.c:1086</div></div>
<div class="ttc" id="agroup__errcheckmacro_html_ga14f67fddf883bc5a22004f4f648c17a5"><div class="ttname"><a href="group__errcheckmacro.html#ga14f67fddf883bc5a22004f4f648c17a5">EXECUTE_SYSTEM_COMMAND</a></div><div class="ttdeci">#define EXECUTE_SYSTEM_COMMAND(...)</div><div class="ttdoc">system call with error checking and handling</div><div class="ttdef"><b>Definition:</b> CLIcore.h:258</div></div>
<div class="ttc" id="agroup__fpsmacro_html_gac759a6212d458404869a2ab872dcddfd"><div class="ttname"><a href="group__fpsmacro.html#gac759a6212d458404869a2ab872dcddfd">FPS_CONNECT</a></div><div class="ttdeci">#define FPS_CONNECT(VARfpsname, VARCMDmode)</div><div class="ttdoc">Connect to FPS.</div><div class="ttdef"><b>Definition:</b> function_parameters.h:722</div></div>
<div class="ttc" id="afps__save2disk_8c_html_abf1f9070b5f20e3823acea7b8127f5b5"><div class="ttname"><a href="fps__save2disk_8c.html#abf1f9070b5f20e3823acea7b8127f5b5">fps_write_RUNoutput_file</a></div><div class="ttdeci">FILE * fps_write_RUNoutput_file(FUNCTION_PARAMETER_STRUCT *fps, const char *filename, const char *extension)</div><div class="ttdoc">Save text file.</div><div class="ttdef"><b>Definition:</b> fps_save2disk.c:261</div></div>
<div class="ttc" id="afps__add__entry_8c_html_ab5fd7ed4766f82b5d24504f5e8b8ebb3"><div class="ttname"><a href="fps__add__entry_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a></div><div class="ttdeci">int function_parameter_add_entry(FUNCTION_PARAMETER_STRUCT *fps, const char *keywordstring, const char *descriptionstring, uint64_t type, uint64_t fpflag, void *valueptr)</div><div class="ttdoc">Add parameter to database with default settings.</div><div class="ttdef"><b>Definition:</b> fps_add_entry.c:20</div></div>
<div class="ttc" id="agroup__fpsmacro_html_gaab206dfb7e0f3a20b61014d25b020ea5"><div class="ttname"><a href="group__fpsmacro.html#gaab206dfb7e0f3a20b61014d25b020ea5">FPS_ADDPARAM_INT64_IN</a></div><div class="ttdeci">#define FPS_ADDPARAM_INT64_IN(key, pname, pdescr, dflt)</div><div class="ttdoc">Add INT64 input parameter entry.</div><div class="ttdef"><b>Definition:</b> function_parameters.h:785</div></div>
<div class="ttc" id="agroup__fpsmacro_html_gae70fe94849793f147fdd38b35fd5d413"><div class="ttname"><a href="group__fpsmacro.html#gae70fe94849793f147fdd38b35fd5d413">FPS_CONFLOOP_START</a></div><div class="ttdeci">#define FPS_CONFLOOP_START</div><div class="ttdoc">Start FPS configuration loop.</div><div class="ttdef"><b>Definition:</b> function_parameters.h:734</div></div>
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="page_coding_standards.html">Coding Standards</a></li>
    <li class="footer">Generated on Fri Sep 11 2020 22:34:29 for milk by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
